<% content_for :navbar do %>
    <%= render 'layouts/nav_book', should_return_to: :back, page: true, book_id: @page.book_id, book: @book  %>
<% end %>


<%= form_with(model: @page, local: true, url:book_page_path(@page.book_id, @page), method: :patch) do |f| %>
    <%= render "devise/shared/error_messages", resource: @page %>
    <%= f.hidden_field :main_title %>

    <section class='page-editor-container'>

        <%= render 'pages/toolbox', edit: true %>

        <% if @page.page_type == "image" %>

            <div class='page-editor'>
                <%= image_tag @page.page_image, id: "image-replace", class: "image-page-upload", onclick: "clickOnFileField();" %>
                <%= f.file_field :page_image, class: "image-page-upload-input", onchange: "previewImage(this);" %>
            </div>

        <% elsif @page.page_type == "title" %>
    
            <div class='page-editor page-title'>
                <%= f.text_area :section_header, size: "50x10", class: "section_header_input" %>
            </div>

        <% elsif @page.page_type == "text" %>

            <div class='page-editor'>
                
            </div>

        <% else %>
            <span>Type of page not recognized.</span>
        <% end %>
    </section>
<% end %>


<script> 

    document.addEventListener('DOMContentLoaded', (event) => {
        const navInput = document.getElementById('page_main_title_nav');
        const hiddenInput = document.getElementById('page_main_title');

        if(navInput && hiddenInput.value !== ''){
            navInput.value = hiddenInput.value; // Set initial value
        }

        navInput.addEventListener('input', function() {
            hiddenInput.value = navInput.value;
        });

    });

    function clickOnFileField(){
        document.getElementById('page_page_image').click()
    }

    function previewImage(input){
        if(input.files && input.files[0]){
            const r = new FileReader()
            const file = input.files[0]

            if(!file.type.startsWith('image/')){
                return
            }

            r.onload = function(e) {
                const preview = document.getElementById('image-replace')
                preview.src = e.target.result
            }

            r.readAsDataURL(file)
        }
    }

</script>
